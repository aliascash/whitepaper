\section{The ‘All\_Spent’ Dilemma}
A ‘\textit{special}‘ situation could occur where all the ATXOs available for a 
certain denomination are spent except for your own ATXO to be used in a transaction. 
We are referring to this situation as the \textbf{\textit{‘ALL\_SPENT’ dilemma}} 
and although this appears to be a very low probability situation in V3 it could 
have dire consequences for privacy and compromise a number of ATXOs. Let’s first 
explain this dilemma in some detail: 

 

A valid ring signature (\textit{assume ring size 10}) needs: \textbf{(1)} An 
unspent ATXO of a certain denomination to be used/spent in the transaction, 
and \textbf{(2)} Nine (9) ‘\textit{mixins}’ of the same denomination 
(\textit{spent or unspent}). These ‘\textit{mixins}’ (ATXOs) of the same 
value as the one being spent provides ‘\textit{plausible deniability}’ with 
regards to the sender. The sender could own any one of the ten ATXOs used 
in the ring-signature and an observer can not determine which one of the 
10 ATXOs forming the ring-signature is being spent. This is at core of 
ring-signature privacy and needs to be preserved. 

 

ATXOs of each denomination are “\textit{scattered}” along the Spectrecoin 
blockchain and exists in various blocks where they were once created and 
they can all be used as ‘\textit{mixins}’ in a ring-signature whether they 
have ever been spent or not. Each ATXO is a ‘\textit{unique unit of data}’ 
identified by its associated ‘\textit{public key}’. However, only the 
owner of an ATXO can determine if an ATXO value has been spent or not 
as this requires the corresponding ‘\textit{private key}’. 



The ATXO picking algorithm for a ring-signature selects 9 ‘\textit{mixins}’ 
at random from the available pool of ATXOs. In each block there could be a 
number of ATXOs of different denominations (\textit{spent or unspent}) 
that could be selected as the 9 ‘\textit{mixins}’. 

 

Any observer will be able to establish the following: \textbf{(1)} In each 
valid ring-signature on the blockchain there will be one and only one ATXO 
of a certain denomination being spent. \textbf{(2)} In each valid 
ring-signature there will be nine ‘\textit{mixins}’ used of the same 
denomination. \textbf{(3)} The observer will be able to count the number 
of existing ATXOs for each denomination by scanning the blockchain. 
\textbf{(4)} The observer will be able to count the number of ATXOs for 
each denomination that has been spent by counting the number of valid 
ring-signatures where this denomination has been used. 

 

As a result, if the ‘ALL\_SPENT‘ situation occurs, i.e.: 

 

\textbf{(number\_of\_\_existing\_ATXOs = number\_of\_spent\_ATXOs) }

 

An observer will be able to categorically determine that each of the ATXOs 
used as a ‘\textit{mixin}‘ in the ring-signature has previously been spent. 
The sender’s privacy has been compromised as the ‘\textit{real}‘ input ATXO 
can be identified, and we no longer have the ‘\textit{plausible deniability}’ 
afforded by the ring-signature. It is important to point out the following 
regarding this issue: 



\begin{itemize}
	\item This only occurs when ALL the ATXOs of a denomination have been 
	spent and a new transaction is created using the depleted denomination.
	\item The privacy of the transaction spending the last unspent ATXO, 
	although creating an ‘ALL\_SPENT‘ situation is not compromised.
	\item If the ‘ALL\_SPENT’ occurs, it would only compromise transaction 
	created after the ‘ALL\_SPENT’. All the previous transactions would still 
	retain their privacy.
\end{itemize}



\subsection{'ALL\_SPENT' illustration}

...

\subsection{Solutions}
A range of measures are being implemented to negate the so called 
\textit{‘ALL\_SPENT’ dilemma}. We realised that this is only likely 
to occur in a situation where there is a very limited supply of 
ATXOs of a certain denomination. 

Therefore, the main approach to solve this problem is to make sure that 
there is always a sufficient supply of ATXOs of varying denominations. 
We have therefore introduced an advanced ATXO balancer algorithm. This 
algorithm will measure the number of ATXO existing for each denomination 
and either seek to consolidate ATXO values or split ATXO values as part 
of the staking transaction in PoAS. This will ensure that there are 
always sufficient supply of ATXO to act as ‘\textit{mixins}‘. 



In addition a new algorithm has been implemented to detect an 
‘\textit{ALL\_SPENT}‘ situation and if this situation does occurs 
the network will ‘\textit{remember}‘ the block height (\textit{block number}) 
and the picking algorithm will no longer pick ‘\textit{mixins}‘ 
from below that block height. This ensures that users get the full 
benefit of the privacy the ring-signature offers. 
